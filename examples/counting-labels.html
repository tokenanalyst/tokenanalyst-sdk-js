<!doctype html>
<html>

<head>
	<title>Counting Labels</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>
	<script src="../dist-web/bundle.js"></script>
</head>

<body>
	<div style="width:100%">
		<canvas id="chart-area"></canvas>
	</div>

	<script>
		const t = new ta.TokenAnalyst();

		var ctx = document.getElementById('chart-area').getContext('2d');

		var chart = new Chart(ctx, {
			// The type of chart we want to create
			type: 'horizontalBar',

			// The data for our dataset
			data: {
				labels: [],
				datasets: [{
					label: "Transactions",
					backgroundColor: 'rgb(255, 99, 132)',
					borderColor: 'rgb(255, 99, 132)',
					data: [0],
				}]
			},

			// Configuration options go here
			options: {}
		});
		Chart.scaleService.updateScaleDefaults('linear', {
			ticks: {
				min: 0
			}
		});

		const counts = {}

		function onRecord(record) {
			if (record.FROMLABEL != null) {
				if (counts[record.FROMLABEL] == undefined)
					counts[record.FROMLABEL] = 1
				else {
					counts[record.FROMLABEL] = counts[record.FROMLABEL] + 1
				}
			}
			if (record.TOLABEL != null) {
				if (counts[record.TOLABEL] == undefined)
					counts[record.TOLABEL] = 1
				else {
					counts[record.TOLABEL] = counts[record.TOLABEL] + 1
				}
			}
			chart.data.labels = Object.keys(counts)
			chart.data.datasets[0].data = Object.values(counts)
			console.log(counts)
			chart.update();
		}

		t.streams.transactionsWithLabelsAndPrice.subscribe(onRecord);
	</script>
</body>

</html>
